<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<head>
    <link rel="stylesheet" th:href="@{/css/board-detail.css}">
</head>

<section layout:fragment="content" class="detail-container">
    <h2>ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°</h2>

    <!-- ê²Œì‹œê¸€ ì •ë³´ -->
    <div class="detail-box">
        <h3 th:text="${board.title}">ì œëª©</h3>
        <p class="meta">
            <span>ì‘ì„±ì: <span th:text="${board.writer.username}">ì‘ì„±ì</span></span> | 
            <span>ì¡°íšŒìˆ˜: <span th:text="${board.hit}">0</span></span> | 
            <span th:if="${board.editdate != null}" th:text="'ìˆ˜ì •ì¼: ' + ${#temporals.format(board.editdate, 'yyyy-MM-dd HH:mm')}" style="font-style: italic;"><span>ìˆ˜ì •ì¼</span></span>
            <span th:if="${board.editdate == null}" th:text="'ì‘ì„±ì¼: ' + ${#temporals.format(board.regdate, 'yyyy-MM-dd HH:mm')}"><span>ì‘ì„±ì¼</span></span>
        </p>
        <div class="content" th:text="${board.content}">
            ê²Œì‹œê¸€ ë‚´ìš©
        </div>
        
        <!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->
	    <div class="post-actions">
	    <a href="javascript:void(0);" class="like-form" 
		   th:data-uri="@{|/board/like/${id}|}">ğŸ¤ ì¢‹ì•„ìš”
		   <span class="like-count" th:text="${#lists.size(board.liker)}"></span></a>
	    </div>
    </div>
    


    <!-- ë²„íŠ¼ ì˜ì—­ -->
    <div class="board-actions">
        <a th:href="@{/board/list}" class="btn-secondary">ëª©ë¡</a>
        <a th:href="@{|/board/edit/${id}|}" class="btn-primary"
        th:if="${(board.writer != null and #authentication.principal.username == board.writer.userid)
        or #authentication.principal.username == 'admin'}" th:text="ìˆ˜ì •">ìˆ˜ì •</a>
        <form th:action="@{|/board/delete/${id}|}" method="post" style="display:inline;">
            <button type="submit" class="delete btn-danger"
            th:if="${(board.writer != null and #authentication.principal.username == board.writer.userid)
            or #authentication.principal.username == 'admin'}" th:text="ì‚­ì œ"
            >ì‚­ì œ</button>
        </form>
    </div>
    


    <!-- ëŒ“ê¸€ ì˜ì—­ -->
    <div class="comment-section">
        <h3>ëŒ“ê¸€</h3>
        
        <!-- ëŒ“ê¸€ ëª©ë¡ -->
        <div class="comment-list">
            <p th:if="${#lists.isEmpty(comments)}">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <p th:if="${!#lists.isEmpty(comments)}" th:text="'ì´ ' + ${comments.size()} + 'ê°œì˜ ë‹µë³€ì´ ìˆìŠµë‹ˆë‹¤.'"></p>
            
            <ul>
                <li th:each="comment : ${comments}">
                    <div class="comment-item">
                        <p class="comment-meta">
                            <span th:text="${comment.user.username}">ëŒ“ê¸€ ì‘ì„±ì</span> | 
                            <span th:text="${#temporals.format(comment.regdate, 'yyyy-MM-dd HH:mm')}">ëŒ“ê¸€ ì‘ì„±ì¼</span>
                        </p>
                        <p class="comment-content" th:text="${comment.content}">ëŒ“ê¸€ ë‚´ìš©</p>
                    </div>
                </li>
            </ul>
        </div>
        
        

        <!-- ëŒ“ê¸€ ì‘ì„± (ê¶Œí•œ ë¶€ì—¬í•´ì•¼ í•¨) -->
        <form th:action="@{|/comment/add/${board.id}|}" method="post" class="comment-form">
            <input type="hidden" name="boardId" th:value="${board.id}" />
            <div class="form-group">
                <label for="writer">ì‘ì„±ì</label>
                <input type="text" th:value="${user.username}" readonly />
                <!-- <input type="text" th:value="${#authentication.name}" readonly /> -->
            </div>
            <div class="form-group">
                <label for="content">ëŒ“ê¸€ ë‚´ìš©</label>
                <textarea id="content" name="content" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn-primary">ë“±ë¡</button>
        </form>

    </div>
</section>
<script layout:fragment="script" type='text/javascript'>
// ê²Œì‹œê¸€ ì‚­ì œ
const delete_elements = document.getElementsByClassName("delete");
Array.from(delete_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        if(confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            location.href = this.dataset.uri;
        };
    });
});
// ê²Œì‹œê¸€ ì¶”ì²œ
const like_elements = document.getElementsByClassName("like-form");
Array.from(like_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        if(confirm("ì •ë§ë¡œ ì¶”ì²œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            location.href = this.dataset.uri;
        };
    });
});
</script>
</html>
